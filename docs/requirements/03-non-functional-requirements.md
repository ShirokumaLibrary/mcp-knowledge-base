# 非機能要件書

## 1. 概要

本書は、Shirokuma MCP Knowledge Base v0.8.0の非機能要件を定義します。パフォーマンス、セキュリティ、可用性、保守性など、システムの品質特性に関する要件を記述します。

## 2. パフォーマンス要件

### 2.1 レスポンスタイム

#### NFR-001: 検索レスポンス
- **要件**: 全文検索のレスポンスタイム
- **目標値**: 
  - 10,000件以下: 500ms以内（P95）
  - 100,000件以下: 1秒以内（P95）
  - 1,000,000件以下: 3秒以内（P95）
- **測定方法**: エンドツーエンドレスポンスタイム

#### NFR-002: CRUD操作レスポンス
- **要件**: 基本的なCRUD操作の応答時間
- **目標値**:
  - CREATE: 200ms以内
  - READ（単一）: 100ms以内
  - UPDATE: 200ms以内
  - DELETE: 200ms以内
- **測定条件**: ローカル環境、単一操作

#### NFR-003: バッチ処理性能
- **要件**: 一括処理の処理速度
- **目標値**:
  - 100件一括更新: 2秒以内
  - 1000件一括更新: 20秒以内
  - 10000件一括更新: 3分以内

### 2.2 スループット

#### NFR-010: 接続方式
- **要件**: シングルユーザー専用
- **目標値**:
  - CLI: シングルユーザー
  - MCP: stdio通信

#### NFR-011: トランザクション処理能力
- **要件**: 1秒あたりのトランザクション数
- **目標値**:
  - 読み取り: 1000 TPS
  - 書き込み: 100 TPS
  - 混合負荷: 500 TPS

### 2.3 リソース使用率

#### NFR-020: メモリ使用量
- **要件**: アプリケーションのメモリフットプリント
- **目標値**:
  - 起動時: 100MB以下
  - 通常運用時: 500MB以下
  - ピーク時: 1GB以下

#### NFR-021: CPU使用率
- **要件**: CPU使用率の制限
- **目標値**:
  - アイドル時: 1%以下
  - 通常負荷: 20%以下
  - ピーク負荷: 80%以下

#### NFR-022: ディスク使用量
- **要件**: データベースサイズの管理
- **目標値**:
  - 10,000アイテム: 100MB以下
  - 100,000アイテム: 1GB以下
  - 1,000,000アイテム: 10GB以下

## 3. スケーラビリティ要件

### 3.1 データスケーラビリティ

#### NFR-030: アイテム数の上限
- **要件**: システムが扱えるアイテム数
- **目標値**:
  - 最小保証: 100,000アイテム
  - 推奨上限: 1,000,000アイテム
  - 理論上限: SQLiteの制限まで

#### NFR-031: タイプ数の上限
- **要件**: 動的に作成可能なタイプ数
- **目標値**:
  - 推奨: 100タイプ以下
  - 上限: 1,000タイプ
- **注**: タイプ数増加による性能劣化に注意

#### NFR-032: タグ数の上限
- **要件**: システムが管理できるタグ数
- **目標値**:
  - 推奨: 1,000タグ以下
  - 上限: 10,000タグ

### 3.2 成長性

#### NFR-040: データ増加への対応
- **要件**: データ量増加時の性能維持
- **戦略**:
  - インデックス最適化
  - クエリ最適化
  - アーカイブ機能（オプション）

## 4. 可用性要件

### 4.1 稼働率

#### NFR-050: システム稼働率
- **要件**: システムの可用性
- **目標値**:
  - CLI: N/A（ローカル実行）
  - MCP: N/A（stdio通信）
  - データベース: 99.99%

### 4.2 障害回復

#### NFR-051: 平均復旧時間（MTTR）
- **要件**: 障害発生から復旧までの時間
- **目標値**:
  - 軽微な障害: 5分以内
  - 中程度の障害: 30分以内
  - 重大な障害: 2時間以内

#### NFR-052: 平均故障間隔（MTBF）
- **要件**: 故障発生の間隔
- **目標値**: 30日以上

### 4.3 バックアップとリカバリ

#### NFR-060: バックアップ頻度
- **要件**: データバックアップの実行頻度
- **目標値**:
  - 自動バックアップ: 日次
  - 手動バックアップ: 任意

#### NFR-061: リカバリ時間目標（RTO）
- **要件**: 障害からの復旧時間
- **目標値**: 1時間以内

#### NFR-062: リカバリポイント目標（RPO）
- **要件**: 許容可能なデータ損失量
- **目標値**: 24時間分まで

## 5. セキュリティ要件

### 5.1 アクセス制御

#### NFR-070: 認証機能
- **要件**: ユーザー認証
- **v0.8.0**: ローカルアクセスのみ、認証なし
- **オプション**: JWT/OAuth2対応可能

#### NFR-071: 認可機能
- **要件**: アクセス権限管理
- **v0.8.0**: 全機能へのフルアクセス
- **オプション**: ロールベースアクセス制御

### 5.2 データ保護

#### NFR-080: データ暗号化
- **要件**: 機密データの保護
- **実装**:
  - 転送時: stdio（ローカル通信）
  - 保存時: SQLite暗号化拡張（オプション）

#### NFR-081: 入力検証
- **要件**: SQLインジェクション等の防止
- **実装**:
  - Prisma ORMによる自動エスケープ
  - 入力値のサニタイゼーション
  - 型チェックの徹底

### 5.3 監査とログ

#### NFR-090: 監査ログ
- **要件**: 重要操作の記録
- **記録項目**:
  - CRUD操作（作成/更新/削除）
  - ログイン試行（認証機能実装時）
  - 設定変更

#### NFR-091: ログ保持期間
- **要件**: ログの保管期間
- **目標値**:
  - 操作ログ: 90日
  - エラーログ: 30日
  - デバッグログ: 7日

## 6. 保守性要件

### 6.1 コード品質

#### NFR-100: テストカバレッジ
- **要件**: 自動テストのカバー率
- **目標値**:
  - ユニットテスト: 90%以上
  - 統合テスト: 70%以上
  - E2Eテスト: 主要シナリオ100%

#### NFR-101: コード複雑度
- **要件**: コードの複雑さ指標
- **目標値**:
  - 循環的複雑度: 10以下
  - 認知的複雑度: 15以下

#### NFR-102: 技術的負債
- **要件**: 技術的負債の管理
- **目標値**:
  - SonarQube技術的負債比率: 5%以下
  - 重大度「高」の問題: 0件

### 6.2 変更容易性

#### NFR-110: モジュール性
- **要件**: コンポーネントの独立性
- **実装**:
  - レイヤードアーキテクチャ
  - 依存性注入
  - インターフェース分離

#### NFR-111: 設定の外部化
- **要件**: 設定変更の容易さ
- **実装**:
  - 環境変数
  - 設定ファイル
  - ランタイム設定変更

### 6.3 ドキュメント

#### NFR-120: ドキュメント完備性
- **要件**: ドキュメントの充実度
- **目標**:
  - APIドキュメント: 100%カバー
  - コードコメント: 公開APIは100%
  - ユーザーマニュアル: 全機能記載

#### NFR-121: ドキュメント更新
- **要件**: ドキュメントの最新性
- **ルール**:
  - コード変更と同時更新
  - 自動生成可能な部分は自動化

## 7. 互換性要件

### 7.1 プラットフォーム互換性

#### NFR-130: OS対応
- **要件**: サポートするOS
- **対象**:
  - Linux (Ubuntu 20.04+, RHEL 8+)
  - macOS (11.0+)
  - Windows (10+, WSL2推奨)

#### NFR-131: Node.jsバージョン
- **要件**: サポートするNode.jsバージョン
- **対象**:
  - 最小: 18.0.0
  - 推奨: 20.0.0以上
  - 最大: Latest LTS

### 7.2 後方互換性

#### NFR-140: API互換性
- **要件**: APIの後方互換性維持
- **ポリシー**:
  - メジャーバージョン内: 完全互換
  - マイナーバージョン: 追加のみ
  - パッチバージョン: バグ修正のみ

#### NFR-141: データ互換性
- **要件**: データフォーマットの互換性
- **ポリシー**:
  - 前方互換: 新バージョンで旧データ読み込み可
  - 後方互換: 可能な限り維持

## 8. 運用性要件

### 8.1 監視

#### NFR-150: 状態確認
- **要件**: システム状態の確認
- **実装**:
  - データベース接続チェック
  - メモリ/CPU使用率モニタリング

#### NFR-151: メトリクス収集
- **要件**: パフォーマンスメトリクス
- **収集項目**:
  - レスポンスタイム
  - エラー率
  - スループット
  - リソース使用率

### 8.2 デプロイメント

#### NFR-160: デプロイ時間
- **要件**: デプロイにかかる時間
- **目標値**:
  - アプリケーション: 5分以内
  - データベース初期化: 30分以内

#### NFR-161: ゼロダウンタイムデプロイ
- **要件**: サービス停止なしのデプロイ
- **v0.8.0**: N/A（シングルインスタンス）

## 9. ユーザビリティ要件

### 9.1 学習容易性

#### NFR-170: 習得時間
- **要件**: 基本機能の習得にかかる時間
- **目標値**:
  - CLI基本操作: 30分以内
  - MCP接続設定: 1時間以内
  - 全機能習得: 1日以内

#### NFR-171: エラーメッセージ
- **要件**: エラーメッセージの品質
- **基準**:
  - 明確な問題説明
  - 解決方法の提示
  - エラーコード付与

### 9.2 アクセシビリティ

#### NFR-180: CLIアクセシビリティ
- **要件**: コマンドラインの使いやすさ
- **実装**:
  - 直感的なコマンド名
  - ヘルプメッセージ
  - タブ補完対応

## 10. 法的・規制要件

### 10.1 ライセンス

#### NFR-190: OSSライセンス遵守
- **要件**: 使用ライブラリのライセンス管理
- **実装**:
  - ライセンスチェック自動化
  - LICENSE.mdの維持
  - 依存関係の明記

### 10.2 データプライバシー

#### NFR-191: 個人情報保護
- **要件**: 個人情報の適切な取り扱い
- **v0.8.0**: ローカルデータのみ、外部送信なし

## 11. 環境要件

### 11.1 開発環境

#### NFR-200: 開発環境構築時間
- **要件**: 新規開発者の環境構築
- **目標値**: 30分以内

#### NFR-201: 開発ツール
- **要件**: 必要な開発ツール
- **ツール**:
  - VSCode推奨
  - ESLint/Prettier設定済み
  - デバッガー設定済み

### 11.2 本番環境

#### NFR-210: 最小システム要件
- **要件**: 動作に必要な最小スペック
- **スペック**:
  - CPU: 2コア以上
  - メモリ: 2GB以上
  - ディスク: 10GB以上の空き容量

## 12. 優先順位

### Priority 1（必須）
- パフォーマンス要件（基本的なレスポンスタイム）
- セキュリティ要件（SQLインジェクション対策）
- 互換性要件（主要OS対応）

### Priority 2（重要）
- スケーラビリティ要件
- 保守性要件（テストカバレッジ）
- ドキュメント要件

### Priority 3（望ましい）
- 高度なパフォーマンス最適化
- 監視・運用機能
- アクセシビリティ機能