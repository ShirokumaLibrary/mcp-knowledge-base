# Commit Guidelines

## Overview

This document outlines the standard procedure for committing changes to the repository. Changes should be separated into logical commits in the following order.

**Important**: Commit messages should only describe the changes made. Do NOT include any references to AI tools, Claude Code, or automated generation in commit messages.

1. Source code (excluding tests)
2. Test code
3. Distribution files (dist/)
4. Documentation

## Commit Order and Procedure

### 1. Source Code Commit

**Files to include:**
- `src/**/*.ts` (excluding test files)
- `src/**/*.js` (excluding test files)
- Configuration files that affect source code (e.g., `tsconfig.json`, `package.json`)

**Exclude:**
- `src/**/*.test.ts`
- `src/**/*.spec.ts`
- `src/__tests__/**`
- `dist/**`
- `docs/**`

**Example commands:**
```bash
# Stage only source files
git add src/ --exclude='*.test.ts' --exclude='*.spec.ts' --exclude='__tests__'
git add package.json tsconfig.json

# Review staged files
git status

# Commit with descriptive message
git commit -m "feat: implement status name-based storage system

- Remove status ID dependencies from markdown files
- Update repositories to use status names
- Add is_closed flag to status management"
```

### 2. Test Code Commit

**Files to include:**
- `src/**/*.test.ts`
- `src/**/*.spec.ts`
- `src/__tests__/**`
- Test configuration files (e.g., `jest.config.js`)

**Example commands:**
```bash
# Stage only test files
git add src/**/*.test.ts src/**/*.spec.ts src/__tests__/
git add jest.config.js

# Commit
git commit -m "test: update tests for status name-based system

- Fix status count expectations
- Update session manager tests
- Add status filtering test cases"
```

### 3. Distribution Files Commit

**Files to include:**
- `dist/**`

**Example commands:**
```bash
# Build the project first
npm run build

# Stage dist files
git add dist/

# Commit
git commit -m "build: update distribution files"
```

### 4. Documentation Commit

**Files to include:**
- `docs/**`
- `README.md`
- `CHANGELOG.md`
- `*.md` (root level documentation)

**Example commands:**
```bash
# Stage documentation files
git add docs/ README.md *.md

# Commit
git commit -m "docs: update documentation for status management changes

- Update API reference
- Revise test cases
- Add commit guidelines"
```

## Commit Message Rules

### What NOT to Include

Never include the following in commit messages:
- References to AI tools (Claude, ChatGPT, Copilot, etc.)
- "Generated by" or "Created with" statements
- Tool attribution or automation mentions
- Meta-information about how the code was written

### What to Include

Focus only on:
- What changed
- Why it changed (if not obvious)
- Impact of the change
- Related issue numbers

❌ Bad examples:
```
feat: add status filtering (generated by Claude Code)
fix: update tests - AI assisted
docs: update README (created with Claude)
```

✅ Good examples:
```
feat: add status filtering to issue and plan lists
fix: update tests for new status name storage
docs: update README with development warning
```

## Best Practices

### 1. Always Build Before Committing Dist

```bash
# Clean and rebuild
npm run clean && npm run build

# Verify no build errors
echo $?  # Should be 0
```

### 2. Run Tests Before Committing Test Code

```bash
# Run all tests
npm test

# Run specific test file
npm test -- --testPathPattern=specific-test
```

### 3. Use Conventional Commits

Format: `<type>(<scope>): <subject>`

Types:
- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation only
- `test`: Test only
- `build`: Build process or dist files
- `refactor`: Code refactoring
- `style`: Code style changes
- `chore`: Maintenance tasks

### 4. Review Each Commit Separately

```bash
# Review staged changes before each commit
git diff --staged

# Use interactive staging if needed
git add -p
```

## Example Workflow

Here's a complete example workflow for a typical change:

```bash
# 1. Make your changes
# ... edit source files, tests, docs ...

# 2. Build and test
npm run build
npm test

# 3. Commit source code
git add src/ --exclude='*.test.ts' --exclude='__tests__'
git status  # Verify only source files are staged
git commit -m "feat: add status filtering to issue/plan lists"

# 4. Commit tests
git add src/**/*.test.ts src/__tests__/
git commit -m "test: add tests for status filtering"

# 5. Commit dist
git add dist/
git commit -m "build: rebuild with status filtering"

# 6. Commit docs
git add docs/ README.md
git commit -m "docs: document status filtering feature"

# 7. Push all commits
git push
```

## Handling Mixed Changes

If you've already made changes to multiple file types:

```bash
# Use git add -p for interactive staging
git add -p

# Or use git gui for visual staging
git gui

# Or temporarily stash changes
git stash push -m "tests and docs"
git add src/  # add only source
git commit -m "feat: implement feature"
git stash pop
# ... continue with other commits
```

## Automated Commit Separation

For large changesets, consider using a script:

```bash
#!/bin/bash
# commit-separator.sh

# Source code
git add $(git diff --name-only | grep -E '^src/.*\.ts$' | grep -v -E '(test|spec)\.ts$|__tests__')
git commit -m "$1 - source"

# Tests
git add $(git diff --name-only | grep -E '(test|spec)\.ts$|__tests__')
git commit -m "$1 - tests"

# Build
npm run build
git add dist/
git commit -m "$1 - build"

# Docs
git add $(git diff --name-only | grep -E '\.(md|MD)$|^docs/')
git commit -m "$1 - docs"
```

Usage: `./commit-separator.sh "feat: new feature"`

## Benefits

1. **Clear History**: Each commit has a single purpose
2. **Easy Review**: Reviewers can focus on one type of change at a time
3. **Better Bisecting**: Finding bugs is easier when commits are focused
4. **Selective Reversion**: Can revert just tests or just docs if needed
5. **CI/CD Friendly**: Can trigger different pipelines based on commit content

## Exceptions

Some changes may not fit this pattern:
- **Hotfixes**: May combine source and tests for speed
- **Initial Setup**: May include everything in one commit
- **Dependencies**: package.json changes affecting multiple areas

Document exceptions in your commit message when deviating from this pattern.